# ventas.kv

#:import hex kivy.utils.get_color_from_hex

<BotonOscuro@Button>:
    background_normal: ''# Elimina la imagen de fondo
    background_color: hex('#393939') # Color gris oscuro

# Etiqueta personalizada con fondo oscuro
<LabelOscuro@Label>:
    canvas.before:
        Color:
            rgba: hex('#393939')# Color de fondo de la etiqueta
        Rectangle:
            size: self.size
            pos: self.pos

# Fila seleccionable que se usa en el carrito de compras (RecycleView principal)

<SelectableBoxLayout>:
    canvas.before:
        Color:
            rgba: hex('#C8F3EF') if self.selected else hex('#F0F0F0')# Cambia el fondo si está seleccionada
        Rectangle:
            pos: self.pos
            size: self.size
    # Columnas de la fila
    Label:
        id: _hashtag# Número de ítem o posición
        size_hint_x: .1
        color: (0, 0, 0, 1)
    Label:
        id: _articulo # Nombre del producto
        size_hint_x: .3
        color: (0, 0, 0, 1)
    Label:
        id: _cantidad # Cantidad seleccionada
        size_hint_x: .2
        color: (0, 0, 0, 1)
    Label:
        id: _precio_por_articulo  # Precio unitario
        size_hint_x: .2
        color: (0, 0, 0, 1)
    Label:
        id: _precio # Precio total por cantidad
        size_hint_x: .2
        color: (0, 0, 0, 1)

# Fila seleccionable en el Popup que muestra productos buscados por nombre
<SelectableBoxLayoutPopup>:
    canvas.before:
        Color:
            rgba: hex('#7A9B87') if self.selected else hex('#393939')# Verde si está seleccionada
        Rectangle:
            size: self.size
            pos: self.pos
    Label:
        id: _codigo # Código del producto
        size_hint_x: .25
        color: (1, 1, 1, 1)
    Label:
        id: _articulo # Nombre del producto
        size_hint_x: .25
        color: (1, 1, 1, 1)
    Label:
        id: _cantidad # Stock disponible
        size_hint_x: .1
        color: (1, 1, 1, 1)
    Label:
        id: _precio # Precio del producto
        size_hint_x: .15
        color: (1, 1, 1, 1)

# Definición del RecycleView
<RV>:
    SelectableRecycleBoxLayout:
        default_size: None, dp(36)  # Altura fija de cada fila
        default_size_hint: 1, None
        size_hint_y: None
        height: self.minimum_height
        orientation: 'vertical'
        multiselect: True # Permite seleccionar varios elementos
        touch_multiselect: False # No permite multiselección con toque largo

# Ventana emergente para mostrar productos encontrados por nombre
<ProductoPorNombrePopup>:
    size_hint: .5, .55
    title: 'Productos' # Título del popup
    BoxLayout:
        orientation: 'vertical'
        BoxLayout:
            size_hint_y: .1
            # Encabezados de la lista
            Label:
                text: 'Código'
                size_hint_x: .25
            Label:
                text: 'Nombre'
                size_hint_x: .25
            Label:
                text: 'Cantidad'
                size_hint_x: .1
            Label:
                text: 'Precio'
                size_hint_x: .15
        # Lista de productos encontrados
        RV:
            id: rvs
            viewclass: 'SelectableBoxLayoutPopup'
        BoxLayout:
            size_hint_y: .2
            Button:
                text: 'Seleccionar'
            Button:
                text: 'Salir'
                on_release: root.dismiss()

# Ventana principal de ventas
<VentasWindow>:
    orientation: 'vertical'
    canvas.before:
        Color:
            rgba: hex('#87CEEB') # Fondo azul claro
        Rectangle:
            size: self.size
            pos: self.pos

 # Encabezado superior con datos del usuario, fecha, hora y botones
    BoxLayout:
        size_hint_y: .1
        spacing: .5
        Label:
            id: bienvenido_label
            size_hint_x: .3
            text: 'Bienvenido: '
            color: hex('#000000')
        GridLayout:
            size_hint_x: .25
            rows: 2
            cols: 2
            Label:
                text: 'Fecha: '
                color: hex('#000000')
            Label:
                id: fecha
                color: hex('#000000')
            Label:
                text: 'Hora:'
                color: hex('#000000')
            Label:
                id: hora
                color: hex('#000000')
        Label:
            size_hint_x: .2
        BotonOscuro:
            id: admin_boton
            size_hint_x: .15
            text: 'Admin'
            on_release: root.admin()
        BotonOscuro:
            id: signout_boton
            size_hint_x: .15
            text: 'Signout'
            on_release: root.signout()

 # Cuerpo principal dividido en izquierda y derecha
    BoxLayout:
        size_hint_y: .87
        spacing: .5
        canvas.before:
            Color:
                rgba: hex('#ffffff')
            Rectangle:
                size: self.size
                pos: self.pos
        # Panel izquierdo: buscador y lista del carrito

        BoxLayout:
            size_hint_x: .30
            orientation: 'vertical'
            spacing: .8
            GridLayout:
                spacing: .5
                size_hint_y: .2
                rows: 2
                cols: 2
                LabelOscuro:
                    text: 'Buscar por Código'
                LabelOscuro:
                    text: 'Buscar por Nombre'
                TextInput:
                    id: buscar_codigo
                    multiline: False
                    on_text_validate: root.agregar_producto_codigo(self.text)
                TextInput:
                    id: buscar_nombre
                    multiline: False
                    on_text_validate: root.agregar_producto_nombre(self.text)
            # Encabezados de la lista
            BoxLayout:
                size_hint_y: 0.10
                spacing: .5
                LabelOscuro:
                    text: '#'
                    size_hint_x: .1
                LabelOscuro:
                    text: 'Artículo'
                    size_hint_x: .3
                LabelOscuro:
                    text: 'Cantidad'
                    size_hint_x: .2
                LabelOscuro:
                    text: 'Precio x Artículo'
                    size_hint_x: .2
                LabelOscuro:
                    text: 'Precio'
                    size_hint_x: .2
            # Lista de productos agregados (carrito)
            RV:
                id: rvs
                viewclass: 'SelectableBoxLayout'
             # Botones para eliminar o modificar ítems
            BoxLayout:
                size_hint_y: .23
                spacing: .5
                BotonOscuro:
                    text: 'Borrar Artículo'
                    on_release: root.eliminar_producto()
                BotonOscuro:
                    text: 'Cambiar Cantidad'
                    on_release: root.modificar_producto()

        # Panel derecho: total, pagar y nueva compra
        BoxLayout:
            size_hint_x: .1195
            orientation: 'vertical'
            canvas.before:
                Color:
                    rgba: hex('#BCD3D2')# Fondo verde claro
                Rectangle:
                    size: self.size
                    pos: self.pos
            GridLayout:
                size_hint_y: .4
                rows: 2
                cols: 2
                Label:
                    text: 'Sub_Total'
                    color: 1, 1, 1, 1
                    canvas.before:
                        Color:
                            rgba: 0, 0, 0, 1
                        Rectangle:
                            pos: self.pos
                            size: self.size
                #Total
                Label:
                    id: sub_total
                    text: '0.00'
                    color: 1, 1, 1, 1
                    canvas.before:
                        Color:
                            rgba: 0, 0, 0, 1
                        Rectangle:
                            pos: self.pos
                            size: self.size
                Label:
                    text: 'Total'
                    color: 1, 1, 1, 1
                    canvas.before:
                        Color:
                            rgba: 0, 0, 0, 1
                        Rectangle:
                            pos: self.pos
                            size: self.size
                Label:
                    id: total
                    text: '0.00'
                    color: 1, 1, 1, 1
                    canvas.before:
                        Color:
                            rgba: 0, 0, 0, 1
                        Rectangle:
                            pos: self.pos
                            size: self.size
            # Notificaciones y botones
            BoxLayout:
                size_hint_y: .6
                orientation: 'vertical'
                spacing: .5
                Label:
                    id: notificacion_fall  # Mensaje de error
                    size_hint_y: .25
                Label:
                    id: notificacion_exitp # Mensaje exitoso
                    size_hint_y: .25
                BotonOscuro:
                    size_hint_y: .25
                    text: 'Pagar'
                    on_release: root.pagar()
                BotonOscuro:
                    size_hint_y: .25
                    text: 'Nueva Compra'
                    on_release: root.nueva_compra()
 # Pie de la ventana (puedes usarlo para notificaciones o copyright)
    BoxLayout:
        size_hint_y: .05
        Label:
            text: 'BoxLayout 3'
            halign: 'center'
            valign: 'middle'
