#ventas.kv DOCUMENTADO

#Importamos función para usar colores hexadecimales

#:import hex kivy.utils.get_color_from_hex
 

# ------------------------------
# BOTÓN OSCURO PERSONALIZADO
# ------------------------------
<BotonOscuro@Button>:
    background_normal: ''  # Quitamos imagen por defecto del botón
    background_color: hex('#393939')  # Color gris oscuro para el botón

# ------------------------------
# ETIQUETA CON FONDO OSCURO
# ------------------------------
<LabelOscuro@Label>:
    canvas.before:
        Color:
            rgba: hex('#393939')  # Fondo gris oscuro para el label
        Rectangle:
            size: self.size
            pos: self.pos

# -----------------------------------------------------------
# FILA SELECCIONABLE PARA EL CARRITO (RecycleView principal)
# -----------------------------------------------------------
<SelectableBoxLayout>:
    canvas.before:
        Color:
            rgba: hex('#C8F3EF') if self.selected else hex('#F0F0F0')  # Cambia color al seleccionar
        Rectangle:
            pos: self.pos
            size: self.size

    # COLUMNAS DE LA FILA DEL CARRITO
    Label:
        id: _hashtag  # Número del ítem
        size_hint_x: .1
        color: (0, 0, 0, 1)
    Label:
        id: _articulo  # Nombre del artículo
        size_hint_x: .3
        color: (0, 0, 0, 1)
    Label:
        id: _cantidad  # Cantidad
        size_hint_x: .2
        color: (0, 0, 0, 1)
    Label:
        id: _precio_por_articulo  # Precio unitario
        size_hint_x: .2
        color: (0, 0, 0, 1)
    Label:
        id: _precio  # Precio total
        size_hint_x: .2
        color: (0, 0, 0, 1)

# -------------------------------------------------------------------
# FILA SELECCIONABLE PARA POPUP DE BÚSQUEDA POR NOMBRE
# -------------------------------------------------------------------
<SelectableBoxLayoutPopup>:
    canvas.before:
        Color:
            rgba: hex('#7A9B87') if self.selected else hex('#393939')  # Verde si está seleccionada
        Rectangle:
            size: self.size
            pos: self.pos

    # COLUMNAS DE LA FILA DEL POPUP
    Label:
        id: _codigo
        size_hint_x: .25
        color: (1, 1, 1, 1)
    Label:
        id: _articulo
        size_hint_x: .25
        color: (1, 1, 1, 1)
    Label:
        id: _cantidad
        size_hint_x: .1
        color: (1, 1, 1, 1)
    Label:
        id: _precio
        size_hint_x: .15
        color: (1, 1, 1, 1)

# ---------------------------
# DEFINICIÓN DEL RECYCLEVIEW
# ---------------------------
<RV>:
    SelectableRecycleBoxLayout:
        default_size: None, dp(36)  # Cada fila tiene altura fija
        default_size_hint: 1, None
        size_hint_y: None
        height: self.minimum_height  # Ajusta altura al contenido
        orientation: 'vertical'
        multiselect: True  # Permite seleccionar varios elementos
        touch_multiselect: False

# ---------------------------------------------
# POPUP PARA MOSTRAR RESULTADOS DE UNA BÚSQUEDA
# ---------------------------------------------
<ProductoPorNombrePopup>:
    size_hint: .5, .55
    title: 'Productos'

    BoxLayout:
        orientation: 'vertical'

        # ENCABEZADOS
        BoxLayout:
            size_hint_y: .1
            Label:
                text: 'Código'
                size_hint_x: .25
            Label:
                text: 'Nombre'
                size_hint_x: .25
            Label:
                text: 'Cantidad'
                size_hint_x: .1
            Label:
                text: 'Precio'
                size_hint_x: .15

        # LISTA RECYCLEVIEW
        RV:
            id: rvs
            viewclass: 'SelectableBoxLayoutPopup'

        # BOTONES DEL POPUP
        BoxLayout:
            size_hint_y: .2
            Button:
                text: 'Seleccionar'
                on_release: root.seleccionar_articulo()
            Button:
                text: 'Salir'
                on_release: root.dismiss()

# -------------------------
# Popop para modificar la cantidad de productos
# -------------------------
<ModificarCantidadPopup>:
    title:"Modificar cantidad"
    size_hint: 0.5, 0.4
    auto_dismiss: False

    BoxLayout:
        orientation: "vertical"
        spacing:10
        padding:10

        Label:
            text:"Ingrese la nueva cantidad"
            size_hint_y:None
            height: "40dp"

        TextInput:
            id: input_cantidad
            hint_text: "Cantidad"
            input_filter: "int"
            multiline: False
            size_hint_y: None
            height: "40dp"

        BoxLayout:
            size_hint_y: None
            height: "40dp"
            spacing: 10

            Button:
                text: "Cancelar"
                on_release: root.dismiss()

            Button:
                text: "Confirmar"
                on_release: root.confirmar()

<ConfirmarPagoPopup>:
    title: "Confirmar pago"
    size_hint: 0.8, 0.4
    auto_dismiss: False

    BoxLayout:
        orientation: "vertical"
        padding: 20
        spacing: 15

        Label:
            text: "Total a pagar"
            font_size: "20sp"
            bold: True
            size_hint_y: None
            height: "40dp"

        Label:
            text: "$ {:.2f}".format(root.total)
            font_size: "26sp"
            color: 0, 0.6, 0, 1
            bold: True

        Widget:
            size_hint_y: None
            height: "10dp"

        BoxLayout:
            size_hint_y: None
            height: "50dp"
            spacing: 10

            Button:
                text: "Cancelar"
                background_color: 0.8, 0.2, 0.2, 1
                on_release: root.dismiss()

            Button:
                text: "Pagar"
                background_color: 0.2, 0.7, 0.2, 1
                on_release: root.confirmar()

# -------------------------
# VENTANA PRINCIPAL DE VENTAS
# -------------------------
<VentasWindow>:
    orientation: 'vertical'

    canvas.before:
        Color:
            rgba: hex('#87CEEB')  # Fondo azul claro
        Rectangle:
            size: self.size
            pos: self.pos

    # -------------------------------------------------
    # ENCABEZADO SUPERIOR (Usuario, fecha, botones)
    # -------------------------------------------------
    BoxLayout:
        size_hint_y: .1
        spacing: .5

        Label:
            id: bienvenido_label
            size_hint_x: .3
            text: 'Bienvenido: '
            color: hex('#000000')

        # FECHA Y HORA
        GridLayout:
            size_hint_x: .25
            rows: 2
            cols: 2
            Label:
                text: 'Fecha:'
                color: hex('#000000')
            Label:
                id: fecha
                color: hex('#000000')
            Label:
                text: 'Hora:'
                color: hex('#000000')
            Label:
                id: hora
                color: hex('#000000')

        Label:
            size_hint_x: .2

        # BOTÓN ADMIN
        BotonOscuro:
            id: admin_boton
            size_hint_x: .15
            text: 'Admin'
            on_release: root.admin()

        # BOTÓN SIGN OUT
        BotonOscuro:
            id: signout_boton
            size_hint_x: .15
            text: 'Signout'
            on_release: root.signout()

    # -------------------------------------------------------
    # CUERPO PRINCIPAL (Panel izquierdo + panel derecho)
    # -------------------------------------------------------
    BoxLayout:
        size_hint_y: .87
        spacing: .5

        canvas.before:
            Color:
                rgba: hex('#FFFFFF')
            Rectangle:
                size: self.size
                pos: self.pos


        # -------------------------------------------
        # PANEL IZQUIERDO (Buscador + carrito)
        # -------------------------------------------
        BoxLayout:
            size_hint_x: .30
            orientation: 'vertical'
            spacing: .8

            # BUSCADORES
            GridLayout:
                spacing: .5
                size_hint_y: .2
                rows: 2
                cols: 2

                LabelOscuro:
                    text: 'Buscar por Código'
                LabelOscuro:
                    text: 'Buscar por Nombre'

                TextInput:
                    id: buscar_codigo
                    multiline: False
                    on_text_validate: root.agregar_producto_codigo(self.text)  # Enter = buscar

                TextInput:
                    id: buscar_nombre
                    multiline: False
                    on_text_validate: root.agregar_producto_nombre(self.text)

            # ENCABEZADOS DE TABLA DE CARRITO
            BoxLayout:
                size_hint_y: 0.10
                spacing: .5
                LabelOscuro:
                    text: '#'
                    size_hint_x: .1
                LabelOscuro:
                    text: 'Artículo'
                    size_hint_x: .3
                LabelOscuro:
                    text: 'Cantidad'
                    size_hint_x: .2
                LabelOscuro:
                    text: 'Precio x Artículo'
                    size_hint_x: .2
                LabelOscuro:
                    text: 'Precio'
                    size_hint_x: .2

            # LISTA DEL CARRITO
            RV:
                id: rvs
                viewclass: 'SelectableBoxLayout'

            # BOTONES PARA EDITAR EL CARRITO
            BoxLayout:
                size_hint_y: .23
                spacing: .5
                BotonOscuro:
                    text: 'Borrar Artículo'
                    on_release: root.eliminar_producto()
                BotonOscuro:
                    text: 'Cambiar Cantidad'
                    on_release: root.modificar_producto()

        # -------------------------------------------
        # PANEL DERECHO (Totales + acciones)
        # -------------------------------------------
        BoxLayout:
            size_hint_x: .1195
            orientation: 'vertical'

            canvas.before:
                Color:
                    rgba: hex('#BCD3D2')  # Fondo verde claro
                Rectangle:
                    size: self.size
                    pos: self.pos

            # -------------------------------
            # SUBTOTAL Y TOTAL
            # -------------------------------
            GridLayout:
                size_hint_y: .4
                rows: 2
                cols: 2

                Label:
                    text: 'Sub_Total'
                    color: 1, 1, 1, 1

                Label:
                    id: sub_total
                    text: '0.00'
                    color: 1, 1, 1, 1

                Label:
                    text: 'Total'
                    color: 1, 1, 1, 1

                Label:
                    id: total
                    text: '0.00'
                    color: 1, 1, 1, 1


            # -------------------------------
            # NOTIFICACIÓN DE ÉXITO
            # -------------------------------
            Label:
                id: notificacion_exito
                text: ""
                size_hint_y: None
                height: self.texture_size[1] if self.text else 0
                color: 0, 0.5, 0, 1
                halign: "center"
                valign: "middle"
                text_size: self.width, None

            # -------------------------------
            # BOTONES
            # -------------------------------
            BoxLayout:
                size_hint_y: .3
                spacing: .5

                BotonOscuro:
                    text: 'Pagar'
                    on_release: root.pagar()

                BotonOscuro:
                    text: 'Cancelar'
                    on_release: root.cancelar()


